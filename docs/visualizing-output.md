# Visualizing LIS Output

This guide will demonstrate several approaches to visualizing output from LIS framework components. There are many different visualization tools available on NCCS Discover, but we will focus our attention on the following tools:

* [GrADS](#grads)
* [Python](#python)

## GrADS

Several of us in the lab like using GrADS because it is quick and handles binary, NetCDF, and GRIB data relatively easy.  It is good for both interactively viewing data as well as scripting for batch processing. Others find GrADS awkward to use or find the output to be ugly. They use other tools like Matlab, Python/matplotlib, or NCL, for visualizing data. We suggest starting with GrADS because all our existing testcases have GrADS descriptor files (*.ctl) to help with plotting the data.

*Note: This section will help you get GrADS running on Discover, but should not be considered a comprehensive reference. Please see the [GrADS Documentation](http://cola.gmu.edu/grads/gadoc/gadoc.php) for detailed descriptions of GrADS functionality and usage.*

First you must set two environment variables so GrADS can find its fonts and supplemental scripts. This should work, and it is safe to put into your `.profile` in your `$HOME`:

```sh
# place after existing entries

export GADDIR=/home/jvgeiger/local/opengrads-2.0.2.oga.2/data
export GASCRP=/home/jvgeiger/SRC/GrADS

# and before "echo sourced clean .profile"
```

There are two versions of GrADS available and they are located at:

|Version|Location|
|-------|--------|
|2.0.1|`$NOBACKUP/../projects/lis/libs/grads/2.0.1/bin/grads`
|2.1.a2|`$NOBACKUP/../projects/lis/libs/grads/2.1.a2/bin/grads`

To run GrADS by simply entering `grads` in the terminal, create an alias in your `.profile` to point to your preferred version. For example:

```sh
...
alias grads=$NOBACKUP/../projects/lis/libs/grads/2.1.a2/bin/grads
...
```

GrADS uses descriptor files with the extension .ctl and .xdf to create plots. To generate a plot from these files enter a command such as:

```sh
grads -lc "open <filename>.ctl
```

Where the `l` flag sets GrADS to plot in landscape layout and the `c` flag tells GrADS to run the command in quotes on execution.

If no visualization appears, one of two things are happening.

1. Your X11 forwarding is not working.  Try running `xclock`.  If clock pops up on your local computer, the X11 forwarding is working.
2. You did not actually tell GrADS to plot anything.

....
grads -lc "open test_out.ctl"
set gxout grfill
q file
d mask
....

`set gxout grfill` tells GrADS to draw full color plot instead of contour lines.  `q file` lists all the fields in the file and should only list "mask." `d mask` tells GrADS to display the mask field.

You may see the following *warning*, but it is safe to ignore:

```sh
Warning: OPTIONS keyword "template" is used, but the
DSET entry contains no substitution templates.
```

### Common Issues

Another error you may encounter 

```
== SDF Descriptor file LVT_MEAN_FINAL_output.xdf was not successfully opened & parsed.
```

I ask for two or create sets of GrADS descriptor files.  One for the expected output (usually called TARGET_OUTPUT), and one for the output generated by my test run.  LVT_MEAN_FINAL_output.xdf is for your run of LVT.  LVT_MEAN_FINAL_target.xdf is for the expected output, or in this case, David's output.  So try this again with `grads -lc "xdfopen LVT_MEAN_FINAL_target.xdf"`.

Whenever you get a "cannot open file" message (or if all your plots say "undefined grid"), then read the ctl file (for example with `less`) looking for the DSET entry.  This points to the file/files that GrADS will open.  (This entry can be confusing to read because it can be templated using syntax similar to the C printf function.)  A mistake here will cause those problems.  If you read LVT_MEAN_FINAL_output.xdf, you will see that it points to " ^output/LVT_MEAN_FINAL.200401060000.d01.nc", which does not exist.  But LVT_MEAN_FINAL_target.xdf points to "^target_output/LVT_MEAN_FINAL.200401060000.d01.nc", which does.  The "^" character is not a typo.  It anchors the filepath to the directory the ctl file is in.

## Python

This section under construction.
